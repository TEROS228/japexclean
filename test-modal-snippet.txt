      {/* Refund Amount Modal */}
      {showRefundModal && (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          width: '100vw',
          height: '100vh',
          backgroundColor: 'rgba(0,0,0,0.8)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 99999
        }}>
          <div style={{
            backgroundColor: 'white',
            padding: '40px',
            borderRadius: '16px',
            maxWidth: '500px',
            width: '90%'
          }}>
            <h2 style={{ marginBottom: '20px', fontSize: '24px' }}>Enter Refund Amount</h2>

            <div style={{ marginBottom: '20px' }}>
              <label style={{ display: 'block', marginBottom: '8px' }}>Amount (¥):</label>
              <input
                type="number"
                value={refundAmount}
                onChange={(e) => setRefundAmount(e.target.value)}
                style={{
                  width: '100%',
                  padding: '10px',
                  border: '2px solid #ccc',
                  borderRadius: '8px',
                  fontSize: '16px'
                }}
              />
            </div>

            <div style={{ display: 'flex', gap: '10px' }}>
              <button
                onClick={() => {
                  setShowRefundModal(false);
                  setRefundAmount("");
                }}
                style={{
                  flex: 1,
                  padding: '12px',
                  backgroundColor: '#gray',
                  color: 'white',
                  border: 'none',
                  borderRadius: '8px',
                  cursor: 'pointer'
                }}
              >
                Cancel
              </button>

              <button
                onClick={async () => {
                  if (!refundAmount || parseFloat(refundAmount) <= 0) {
                    alert('Please enter a valid amount');
                    return;
                  }

                  try {
                    const token = localStorage.getItem('auth_token');
                    const response = await fetch(`/api/admin/packages/${selectedCancelPackage.id}/update-cancel-purchase`, {
                      method: 'POST',
                      headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                      },
                      body: JSON.stringify({
                        status: 'approved',
                        refundAmount: parseFloat(refundAmount)
                      })
                    });

                    if (response.ok) {
                      alert(`✅ Refund completed! ¥${refundAmount} credited to customer.`);
                      setShowRefundModal(false);
                      setRefundAmount("");
                      fetchCancelPurchaseRequests();
                    } else {
                      const data = await response.json();
                      alert(`Error: ${data.error}`);
                    }
                  } catch (error) {
                    console.error('Error:', error);
                    alert('Failed to process refund');
                  }
                }}
                style={{
                  flex: 1,
                  padding: '12px',
                  backgroundColor: '#16a34a',
                  color: 'white',
                  border: 'none',
                  borderRadius: '8px',
                  cursor: 'pointer'
                }}
              >
                Confirm Refund
              </button>
            </div>
          </div>
        </div>
      )}
